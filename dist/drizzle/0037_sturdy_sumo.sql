CREATE TABLE `affiliate_applications` (
	`id` int AUTO_INCREMENT NOT NULL,
	`discoveryId` int NOT NULL,
	`applicationType` enum('email','form_fill','api_signup','network_apply') NOT NULL DEFAULT 'email',
	`app_subject` text,
	`app_body` text,
	`formData` json,
	`app_status` enum('drafted','approved','sent','pending','accepted','rejected') NOT NULL DEFAULT 'drafted',
	`app_sentAt` timestamp,
	`responseReceivedAt` timestamp,
	`responseContent` text,
	`app_aiGenerated` boolean NOT NULL DEFAULT true,
	`app_createdAt` timestamp NOT NULL DEFAULT (now()),
	CONSTRAINT `affiliate_applications_id` PRIMARY KEY(`id`)
);
--> statement-breakpoint
CREATE TABLE `affiliate_discoveries` (
	`id` int AUTO_INCREMENT NOT NULL,
	`name` varchar(256) NOT NULL,
	`domain` varchar(512) NOT NULL,
	`description` text,
	`vertical_disc` enum('ai_tools','hosting','dev_tools','security','vpn','crypto','saas','education','automation','analytics','design','marketing','fintech','other') NOT NULL DEFAULT 'other',
	`estimatedCommissionType` enum('revshare','cpa','hybrid','unknown') NOT NULL DEFAULT 'unknown',
	`estimatedCommissionRate` int NOT NULL DEFAULT 0,
	`revenueScore` int NOT NULL DEFAULT 0,
	`relevanceScore` int NOT NULL DEFAULT 0,
	`overallScore` int NOT NULL DEFAULT 0,
	`affiliateProgramUrl` text,
	`signupUrl` text,
	`contactEmail` varchar(320),
	`networkName` varchar(128),
	`discovery_status` enum('discovered','evaluating','approved','applied','accepted','rejected','skipped') NOT NULL DEFAULT 'discovered',
	`applicationStatus` enum('not_applied','application_drafted','application_sent','pending_review','approved','rejected') NOT NULL DEFAULT 'not_applied',
	`applicationDraftedAt` timestamp,
	`disc_applicationSentAt` timestamp,
	`applicationResponseAt` timestamp,
	`discoveredBy` enum('llm_search','network_crawl','competitor_analysis','manual') NOT NULL DEFAULT 'llm_search',
	`discoveryBatchId` varchar(64),
	`notes` text,
	`disc_metadata` json,
	`promotedToPartnerId` int,
	`disc_createdAt` timestamp NOT NULL DEFAULT (now()),
	`disc_updatedAt` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,
	CONSTRAINT `affiliate_discoveries_id` PRIMARY KEY(`id`)
);
--> statement-breakpoint
CREATE TABLE `affiliate_discovery_runs` (
	`id` int AUTO_INCREMENT NOT NULL,
	`batchId` varchar(64) NOT NULL,
	`runType` enum('scheduled','manual','startup') NOT NULL DEFAULT 'scheduled',
	`run_status` enum('running','completed','failed','killed') NOT NULL DEFAULT 'running',
	`programsDiscovered` int NOT NULL DEFAULT 0,
	`programsEvaluated` int NOT NULL DEFAULT 0,
	`programsApproved` int NOT NULL DEFAULT 0,
	`applicationsGenerated` int NOT NULL DEFAULT 0,
	`applicationsSent` int NOT NULL DEFAULT 0,
	`searchQueries` json,
	`run_errors` json,
	`startedAt` timestamp NOT NULL DEFAULT (now()),
	`completedAt` timestamp,
	`durationMs` int NOT NULL DEFAULT 0,
	`killSwitchTriggered` boolean NOT NULL DEFAULT false,
	CONSTRAINT `affiliate_discovery_runs_id` PRIMARY KEY(`id`),
	CONSTRAINT `affiliate_discovery_runs_batchId_unique` UNIQUE(`batchId`)
);
